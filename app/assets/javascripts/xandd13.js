!function(e){e.fn.gMap=function(t,n){switch(t){case"addMarker":return e(this).trigger("gMap.addMarker",[n.latitude,n.longitude,n.content,n.icon,n.popup]);case"centerAt":return e(this).trigger("gMap.centerAt",[n.latitude,n.longitude,n.zoom]);case"clearMarkers":return e(this).trigger("gMap.clearMarkers")}var r=e.extend({},e.fn.gMap.defaults,t);return this.each(function(){var t=new google.maps.Map(this);e(this).data("gMap.reference",t);var n=new google.maps.Geocoder;r.address?n.geocode({address:r.address},function(e){e&&e.length&&t.setCenter(e[0].geometry.location)}):r.latitude&&r.longitude?t.setCenter(new google.maps.LatLng(r.latitude,r.longitude)):e.isArray(r.markers)&&r.markers.length>0?r.markers[0].address?n.geocode({address:r.markers[0].address},function(e){e&&e.length>0&&t.setCenter(e[0].geometry.location)}):t.setCenter(new google.maps.LatLng(r.markers[0].latitude,r.markers[0].longitude)):t.setCenter(new google.maps.LatLng(34.885931,9.84375)),t.setZoom(r.zoom),t.setMapTypeId(google.maps.MapTypeId[r.maptype]);var i={scrollwheel:r.scrollwheel,disableDoubleClickZoom:!r.doubleclickzoom};r.controls===!1?e.extend(i,{disableDefaultUI:!0}):0!==r.controls.length&&e.extend(i,r.controls,{disableDefaultUI:!0}),t.setOptions(i);var o,a,s=new google.maps.Marker;o=new google.maps.MarkerImage(r.icon.image),o.size=new google.maps.Size(r.icon.iconsize[0],r.icon.iconsize[1]),o.anchor=new google.maps.Point(r.icon.iconanchor[0],r.icon.iconanchor[1]),s.setIcon(o),r.icon.shadow&&(a=new google.maps.MarkerImage(r.icon.shadow),a.size=new google.maps.Size(r.icon.shadowsize[0],r.icon.shadowsize[1]),a.anchor=new google.maps.Point(r.icon.shadowanchor[0],r.icon.shadowanchor[1]),s.setShadow(a)),e(this).bind("gMap.centerAt",function(e,n,r,i){i&&t.setZoom(i),t.panTo(new google.maps.LatLng(parseFloat(n),parseFloat(r)))});var l=[];e(this).bind("gMap.clearMarkers",function(){for(;l[0];)l.pop().setMap(null)});var u;e(this).bind("gMap.addMarker",function(e,n,i,o,a,c){var d,f,p=new google.maps.LatLng(parseFloat(n),parseFloat(i)),h=new google.maps.Marker({position:p});if(a?(d=new google.maps.MarkerImage(a.image),d.size=new google.maps.Size(a.iconsize[0],a.iconsize[1]),d.anchor=new google.maps.Point(a.iconanchor[0],a.iconanchor[1]),h.setIcon(d),a.shadow&&(f=new google.maps.MarkerImage(a.shadow),f.size=new google.maps.Size(a.shadowsize[0],a.shadowsize[1]),f.anchor=new google.maps.Point(a.shadowanchor[0],a.shadowanchor[1]),s.setShadow(f))):(h.setIcon(s.getIcon()),h.setShadow(s.getShadow())),o){"_latlng"===o&&(o=n+", "+i);var m=new google.maps.InfoWindow({content:r.html_prepend+o+r.html_append});google.maps.event.addListener(h,"click",function(){u&&u.close(),m.open(t,h),u=m}),c&&google.maps.event.addListenerOnce(t,"tilesloaded",function(){m.open(t,h)})}h.setMap(t),l.push(h)});for(var c,d=this,f=function(t){return function(n){n&&n.length>0&&e(d).trigger("gMap.addMarker",[n[0].geometry.location.lat(),n[0].geometry.location.lng(),t.html,t.icon,t.popup])}},p=0;p<r.markers.length;p++)c=r.markers[p],c.address?("_address"===c.html&&(c.html=c.address),n.geocode({address:c.address},f(c))):e(this).trigger("gMap.addMarker",[c.latitude,c.longitude,c.html,c.icon,c.popup])})},e.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);